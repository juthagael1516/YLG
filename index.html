<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Find my table / ‡πÄ‡∏ä‡πá‡∏Ñ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-white to-slate-50 text-slate-800">
  <div id="root"></div>

  <!-- React & Babel -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;

    // ---------- SETTINGS ----------
    const CSV_URL = "./guest-list.csv"; // guest-list.csv ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô repo ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö index.html

    // ---------- HELPERS ----------
    const normalizeName = (s) => s.trim().toLowerCase().replace(/\s+/g, " ");

    function parseCSV(text) {
      const lines = text.replace(/\r/g,"").split("\n").map(l=>l.trim());
      const rows  = lines.filter(Boolean);
      if (!rows.length) return [];
      const header = (rows[0].match(/("([^"]*)"|[^,]+)/g) || []).map(c=>c.replace(/^"(.*)"$/,"$1").trim().toLowerCase());
      const nameIdx  = header.findIndex(h => /name/.test(h));
      const tableIdx = header.findIndex(h => /table/.test(h));
      const out = [];
      for (let i=1; i<rows.length; i++){
        const cols = rows[i].match(/("([^"]*)"|[^,]+)/g) || [];
        const get  = (idx) => (cols[idx]||"").replace(/^"(.*)"$/,"$1").trim();
        const name  = nameIdx  >=0 ? get(nameIdx)  : "";
        const table = tableIdx >=0 ? get(tableIdx) : "";
        if (name) out.push({ name, table: table || "" });
      }
      return out;
    }

    function App(){
      const [guests, setGuests]   = useState([]);
      const [name, setName]       = useState("");
      const [result, setResult]   = useState(null);
      const [err, setErr]         = useState("");
      const [loading, setLoading] = useState(true);

      // Prefill from ?name= or ?guest=
      useEffect(()=>{
        const q = new URLSearchParams(window.location.search);
        const urlName = q.get("name") || q.get("guest");
        if (urlName) setName(urlName);
      },[]);

      // Auto-load CSV on startup
      useEffect(()=>{
        (async () => {
          try{
            const res = await fetch(CSV_URL + "?t=" + Date.now(), { cache: "no-store" });
            if (!res.ok) throw new Error("CSV not found");
            const text = await res.text();
            const list = parseCSV(text);
            setGuests(list);
            setErr("");
          }catch(e){
            setErr("Could not load guest list. Please contact staff. / ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏Ç‡∏Å‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà");
          }finally{
            setLoading(false);
          }
        })();
      },[]);

      const index = useMemo(() => {
        const m = new Map();
        guests.forEach(g => m.set(normalizeName(g.name), g));
        return m;
      }, [guests]);

      function lookup(){
        setErr(""); setResult(null);
        const key = normalizeName(name);
        if (!key){
          setErr("Please enter your name as on envelope. / ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ã‡∏≠‡∏á");
          return;
        }
        const hit = index.get(key);
        if (hit) setResult(hit);
        else setErr("Name not found. Please check spelling or contact staff. / ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ä‡∏∑‡πà‡∏≠ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏Å‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà");
      }

      const renderTableValue = (table) => {
        const empty = !table || table.trim() === "" || table === "-";
        return empty ? "Standing zone / ‡∏™‡πÅ‡∏ï‡∏ô‡∏î‡πå‡∏î‡∏¥‡∏á‡πÇ‡∏ã‡∏ô" : table;
      };

      return (
        <div className="max-w-xl mx-auto px-4 py-8">
          <header className="mb-6 text-center">
            <h1 className="text-3xl font-semibold tracking-tight">Find my table / ‡πÄ‡∏ä‡πá‡∏Ñ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞</h1>
            <p className="text-sm text-slate-500 mt-1">
              Type your name as on envelope to see your table. / ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ã‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞
            </p>
          </header>

          {loading && (
            <div className="mb-4 px-4 py-3 bg-slate-50 text-slate-700 rounded-2xl ring-1 ring-slate-200">
              Loading guest list‚Ä¶ / ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏Ç‡∏Å‚Ä¶
            </div>
          )}

          <div className="bg-white rounded-2xl p-4 ring-1 ring-slate-200 shadow-sm mb-4">
            <label className="text-sm font-medium">Name as on envelope / ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏ã‡∏≠‡∏á</label>
            <input
              className="mt-2 w-full rounded-xl ring-1 ring-slate-200 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-slate-900"
              placeholder="e.g., Somchai Prasert / ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡∏ö‡∏ô‡∏ã‡∏≠‡∏á"
              value={name}
              onChange={(e) => setName(e.target.value)}
              onKeyDown={(e) => { if (e.key === 'Enter') lookup(); }}
              disabled={loading}
            />
            <div className="mt-3">
              <button
                onClick={lookup}
                className="w-full md:w-auto px-4 py-2 rounded-xl bg-slate-900 text-white hover:bg-slate-800 disabled:opacity-50"
                disabled={loading}
              >
                Show my table / ‡∏î‡∏π‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞
              </button>
            </div>
          </div>

          {err && (
            <div className="mb-4 px-4 py-3 bg-rose-50 text-rose-700 rounded-2xl ring-1 ring-rose-200">
              {err}
            </div>
          )}

          {result && (
            <div className="mb-4 p-5 rounded-2xl bg-emerald-50 ring-1 ring-emerald-200 text-center">
              <p className="text-sm text-emerald-700">Welcome / ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</p>
              <h2 className="text-2xl font-semibold">{result.name}</h2>
              <div className="mt-2 text-emerald-800">Your table is / ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÇ‡∏ï‡πä‡∏∞</div>
              <div className="text-5xl font-bold tracking-tight">
                {renderTableValue(result.table)}
              </div>
              <div className="mt-3 text-xs text-emerald-700/80">
                Show this screen to our staff. Enjoy the celebration ü§ç<br/>
                ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏á‡∏≤‡∏ô
              </div>
            </div>
          )}

          <footer className="mt-10 text-[11px] text-slate-500 text-center">
            This page loads the guest list from <code>guest-list.csv</code> on each visit. /
            ‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏Ç‡∏Å‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå <code>guest-list.csv</code> ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î
          </footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
